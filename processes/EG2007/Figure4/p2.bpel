<!-- P BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Mon May 16 09:08:35 CEST 2011 -->
<bpel:process name="P"
         targetNamespace="http://www.example.com/figure4"
         suppressJoinFailure="yes"
         xmlns:tns="http://www.example.com/figure4"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:ns1="http://www.example.org/matching/process/interface" 
         >
         
    <bpel:import namespace="http://www.example.org/matching/process/interface" location="process.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>

    <bpel:partnerLinks>
        <bpel:partnerLink name="process" partnerLinkType="ns1:processPLT" myRole="process"></bpel:partnerLink>
	</bpel:partnerLinks>

    <!-- ================================================================= -->         
    <!-- ORCHESTRATION LOGIC                                               -->
    <!-- Set of activities coordinating the flow of messages across the    -->
    <!-- services integrated within this business process                  -->
    <!-- ================================================================= -->         
    <bpel:variables>
        <bpel:variable name="processRequest" messageType="ns1:ReceiveOrderRequest"></bpel:variable>
        <bpel:variable name="processRequest1" messageType="ns1:ReceivePaymentRequestRequest"></bpel:variable>
        <bpel:variable name="processRequest2" messageType="ns1:ReceiveAddOrderRequestRequest"></bpel:variable>
    </bpel:variables>
    <bpel:sequence name="main">
        <bpel:receive name="ReceiveOrder" partnerLink="process" operation="ReceiveOrder" portType="ns1:process" variable="processRequest"></bpel:receive>
        
        <bpel:repeatUntil name="RepeatUntil">
            <bpel:receive name="ReceiveAddOrderRequest" partnerLink="process" operation="ReceiveAddOrderRequest" portType="ns1:process" variable="processRequest2"></bpel:receive>
        </bpel:repeatUntil>
        <bpel:receive name="ReceivePaymentRequest" partnerLink="process" operation="ReceivePaymentRequest" portType="ns1:process" variable="processRequest1"></bpel:receive>
        
	</bpel:sequence>    
</bpel:process>

