<!-- serviceConsumer BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Sun Oct 02 18:03:54 CEST 2011 -->
<bpel:process name="serviceConsumer"
         targetNamespace="http://www.example.com/matching/EDOC/Figure2/process"
         suppressJoinFailure="yes"
         xmlns:tns="http://www.example.com/matching/EDOC/Figure2/process"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:ns1="http://www.example.com/matching/EDOC/Figure5/partner/interface" xmlns:ns2="http://www.example.com/matching/EDOC/Figure5/process/interface">
         
	<bpel:extensions>
		<bpel:extension namespace="http://www.cs.helsinki.fi/u/anorta/research/eSourcing/" mustUnderstand="yes" />
	</bpel:extensions>

    <!-- Import the client WSDL -->
    <bpel:import namespace="http://www.example.com/matching/EDOC/Figure5/partner/interface" location="partner.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
    <bpel:import namespace="http://www.example.com/matching/EDOC/Figure5/process/interface" location="process.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>

    <!-- ================================================================= -->         
    <!-- ORCHESTRATION LOGIC                                               -->
    <!-- Set of activities coordinating the flow of messages across the    -->
    <!-- services integrated within this business process                  -->
    <!-- ================================================================= -->         
    <bpel:partnerLinks>
        <bpel:partnerLink name="process" partnerLinkType="ns2:processPLT" myRole="process"></bpel:partnerLink>
        <bpel:partnerLink name="partner" partnerLinkType="ns1:partnerPLT" partnerRole="partner"></bpel:partnerLink>
    </bpel:partnerLinks>
    <bpel:variables>
        <bpel:variable name="processRequest" messageType="ns2:orderWaterPumpRequest"></bpel:variable>
        <bpel:variable name="partnerRequest" messageType="ns1:prepareSpecificationRequest"></bpel:variable>
        <bpel:variable name="partnerRequest1" messageType="ns1:preparePaymentRequest"></bpel:variable>
    </bpel:variables>
    <bpel:sequence name="SEQ">
        <bpel:receive name="oWp" partnerLink="process" operation="orderWaterPump" variable="processRequest"></bpel:receive>
        
        <bpel:flow name="FLOW"><bpel:sequence name="SEQ1">
                <bpel:invoke name="pS" partnerLink="partner" operation="prepareSpecification" inputVariable="partnerRequest">
                    <bpel:sources>
                        <bpel:source linkName="start-sourcing"></bpel:source>
                    </bpel:sources>
                </bpel:invoke>
                <bpel:invoke name="pPa" partnerLink="partner" operation="preparePayment" portType="ns1:partner" inputVariable="partnerRequest1">
                    <bpel:sources>
                        <bpel:source linkName="end-sourcing"></bpel:source>
                    </bpel:sources>
                </bpel:invoke>
            </bpel:sequence><bpel:scope name="OUTSOURCE">
                <bpel:sequence name="SEQ2">
                    <bpel:receive name="cR" partnerLink="process" operation="configureResources" portType="ns2:process" variable="processRequest1" xmlns:m="http://www.cs.helsinki.fi/u/anorta/research/eSourcing/" m:status="invokable">
                        <bpel:targets>
                            <bpel:target linkName="start-sourcing"></bpel:target>
                        </bpel:targets>
                    </bpel:receive>
                    <bpel:flow name="FLOW1">
                    	<bpel:invoke name="pT" partnerLink="partner" operation="produceTank" portType="ns1:partner" inputVariable="partnerRequest2" xmlns:m="http://www.cs.helsinki.fi/u/anorta/research/eSourcing/" m:status="observable"></bpel:invoke>
                    	<bpel:invoke name="pPu" partnerLink="partner" operation="producePump" portType="ns1:partner" inputVariable="partnerRequest2" xmlns:m="http://www.cs.helsinki.fi/u/anorta/research/eSourcing/" m:status="observable"></bpel:invoke>
                    </bpel:flow>
                    <bpel:receive name="aW" partnerLink="process" operation="assembleWatertank" portType="ns2:process" variable="processRequest1" xmlns:m="http://www.cs.helsinki.fi/u/anorta/research/eSourcing/" m:status="invokable">
                        <bpel:targets>
                            <bpel:target linkName="end-sourcing"></bpel:target>
                        </bpel:targets>
                    </bpel:receive>
                </bpel:sequence>
            </bpel:scope><bpel:links>
                <bpel:link name="start-sourcing"></bpel:link>
                <bpel:link name="end-sourcing"></bpel:link>
            </bpel:links></bpel:flow>
        <bpel:invoke name="pB" partnerLink="partner" operation="payBill"></bpel:invoke>
    </bpel:sequence>    
</bpel:process>

